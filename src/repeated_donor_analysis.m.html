<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>repeated_donor_analysis API documentation</title>
    <meta name="description" content="Repeated Donor Analysis

This module processes a donations given in the FEC format and a percentile ..." />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#repeated_donor_analysis.recipients">recipients</a></li>
    <li class="mono"><a href="#repeated_donor_analysis.repeat_donors">repeat_donors</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#repeated_donor_analysis.add_donor">add_donor</a></li>
    <li class="mono"><a href="#repeated_donor_analysis.add_recipients">add_recipients</a></li>
    <li class="mono"><a href="#repeated_donor_analysis.extract">extract</a></li>
    <li class="mono"><a href="#repeated_donor_analysis.format_entry">format_entry</a></li>
    <li class="mono"><a href="#repeated_donor_analysis.is_valid">is_valid</a></li>
    <li class="mono"><a href="#repeated_donor_analysis.main">main</a></li>
    <li class="mono"><a href="#repeated_donor_analysis.percentile_count">percentile_count</a></li>
    <li class="mono"><a href="#repeated_donor_analysis.process_file">process_file</a></li>
  </ul>

    </li>


    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">repeated_donor_analysis</span> module</h1>
  <p>Repeated Donor Analysis</p>
<p>This module processes a donations given in the FEC format and a percentile value.
It identifies repeated donors and computes the number of donations, the
total amount of donations and the percentile of donations from  repeated
to donors from a given zip code to a fixed recipient.</p>
<p>Example:
        $ python repeated_donor_analysis.py input_file output_file percentile</p>
<p>Attributes:
    repeat_donors (dict): stores a donor's (identified by name and zip-code)
        earliest year of donation. This allows determining whether a donation
        comes from a repeated donor in constant time
    recipients (dict): stores the $-amount of donations
        under the key (recipient, zip-code, year). The values are stored in a
        sorted list to allow for efficient percentile computations.</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-repeated_donor_analysis', this);">Show source &equiv;</a></p>
  <div id="source-repeated_donor_analysis" class="source">
    <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;Repeated Donor Analysis</span>

<span class="sd">This module processes a donations given in the FEC format and a percentile value.</span>
<span class="sd">It identifies repeated donors and computes the number of donations, the</span>
<span class="sd">total amount of donations and the percentile of donations from  repeated</span>
<span class="sd">to donors from a given zip code to a fixed recipient.</span>


<span class="sd">Example:</span>
<span class="sd">        $ python repeated_donor_analysis.py input_file output_file percentile</span>

<span class="sd">Attributes:</span>
<span class="sd">    repeat_donors (dict): stores a donor&#39;s (identified by name and zip-code)</span>
<span class="sd">        earliest year of donation. This allows determining whether a donation</span>
<span class="sd">        comes from a repeated donor in constant time</span>
<span class="sd">    recipients (dict): stores the $-amount of donations</span>
<span class="sd">        under the key (recipient, zip-code, year). The values are stored in a</span>
<span class="sd">        sorted list to allow for efficient percentile computations.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">sortedcontainers</span> <span class="kn">import</span> <span class="n">SortedList</span>

<span class="n">repeat_donors</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">recipients</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Extracts the system arguments and runs process_file</span>
<span class="sd">    </span>
<span class="sd">    The function reads three inputs from the command line:</span>
<span class="sd">    input file, output file and a file containing a single</span>
<span class="sd">    integer, the percentile value. It checks that there are</span>
<span class="sd">    enough arguments and passes them on to the reader.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">process_file</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">process_file</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">,</span> <span class="n">percentile_file_path</span><span class="p">,</span>  <span class="n">output_file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Given a percentile, an input and an output file, computes percentiles of donations</span>

<span class="sd">    The function reads the input file sequentually and saves repeated donors.</span>
<span class="sd">    If a line contains donation from a repeated donor, then for the recipients</span>
<span class="sd">    donations from repeated donors from this zip code, the percentile value is</span>
<span class="sd">    computed and the information is stored in the output_content strin.</span>
<span class="sd">    After having processed the input file, output_content is written into the</span>
<span class="sd">    output_file_path.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        input_file_path (string): A string with the path to the input file</span>
<span class="sd">        percentile_file_path (string): A string with the path to the</span>
<span class="sd">            file that contains the percentile value</span>
<span class="sd">        output_file_path (string): A string with the path to the output file</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">percentile_file_path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Read percentile value and convert it to integer</span>
        <span class="n">percentile_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">percentile_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    
        <span class="k">try</span><span class="p">:</span>
            <span class="n">percentile</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">percentile_file</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Percentile was not an integer&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">percentile_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Store output in variable, slightly faster then dumping lines individually</span>
        <span class="n">output_content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># Process evert line of input file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_file</span><span class="p">:</span>
                <span class="n">entry</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_valid</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
                    <span class="c1"># extract relevant details of donation</span>
                    <span class="n">donation</span> <span class="o">=</span> <span class="n">extract</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                    <span class="c1"># update donors information in repeat_donor</span>
                    <span class="n">add_donor</span><span class="p">(</span><span class="n">donation</span><span class="p">)</span>
                    <span class="c1"># check if donation is from repeated donor, return recipient</span>
                    <span class="n">recipient_key</span> <span class="o">=</span> <span class="n">add_recipients</span><span class="p">(</span><span class="n">donation</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">recipient_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">output_content</span> <span class="o">+=</span> <span class="n">format_entry</span><span class="p">(</span><span class="n">percentile</span><span class="p">,</span> <span class="n">recipient_key</span><span class="p">)</span>
                        <span class="n">output_content</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1"># Save output to file</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_content</span><span class="p">)</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;There was an error reading/writing the files.&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">format_entry</span><span class="p">(</span><span class="n">percentile</span><span class="p">,</span> <span class="n">recipient_key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Given a percentile and (recipient,zip-code,year) key, returns the output string </span>

<span class="sd">    The output string has the format:</span>
<span class="sd">    &#39;recipient|zip-code|year|percentile_value|total_amount|number of contributions&#39;</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        percentile (int): percentile value that is computed</span>
<span class="sd">        recipient_key (tuple): A tuple of the form (recipient, zip-code, year),</span>
<span class="sd">            this is the key to the record we want to compute the percentile of.</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        line (string): a string summarizing the recipients donations</span>
<span class="sd">            from the zip code in the given year.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">percentile_value</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">percentile_count</span><span class="p">(</span><span class="n">percentile</span><span class="p">,</span> <span class="n">recipient_key</span><span class="p">)</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">recipients</span><span class="p">[</span><span class="n">recipient_key</span><span class="p">]</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">recipient_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span> <span class="o">+</span> <span class="n">recipient_key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span>
    <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">recipient_key</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span>
    <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">percentile_value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span>
    <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line</span>


<span class="k">def</span> <span class="nf">percentile_count</span><span class="p">(</span><span class="n">percentile</span><span class="p">,</span> <span class="n">recipient_key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Given a percentile and (recipient,zip-code,year) key, returns the percentile and the count of the contributions</span>

<span class="sd">    It uses the recipient_key to access all donations to the recipient in the</span>
<span class="sd">    given year and zip-code. These donations are in the form of a sorted list,</span>
<span class="sd">    the percentile can be easily computed via the nearest rank method.</span>
<span class="sd">    The number of contributions is also computed and returned. Returns</span>
<span class="sd">    0, -1 if key is not valid and 0, -2 if percentile is not valid.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        percentile (int): percentile value that is computed</span>
<span class="sd">        recipient_key (tuple): A tuple of the form (recipient, zip-code, year), this is the key</span>
<span class="sd">            to the record we want to compute the percentile of.</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        percentile value (int): Percentile value of contributions</span>
<span class="sd">        count (init): number of contributions</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recipients</span><span class="p">[</span><span class="n">recipient_key</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">percentile</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">recipients</span><span class="p">[</span><span class="n">recipient_key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">count</span>
        <span class="k">if</span> <span class="n">percentile</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">or</span> <span class="n">percentile</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span>
        <span class="c1"># use nearest rank method to compute percentile</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">percentile</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">count</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">recipients</span><span class="p">[</span><span class="n">recipient_key</span><span class="p">][</span><span class="n">index</span><span class="p">]),</span> <span class="n">count</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>


<span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Given a line containing a valid donation, extracts the information we need.</span>

<span class="sd">    It extracts CMTE_ID, Name of donor, Zip-code, Year,</span>
<span class="sd">    and amount of donation in a list in this order. As we only apply this function after</span>
<span class="sd">    checking entry for validity, no exceptions are handled.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        line (list): list containing the details of a valid donation</span>
<span class="sd">        from the original file</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        entry (list): Returns a list with the relevant details of the donation,</span>
<span class="sd">            it has the formation [CMTE_ID, Name, Zip-code, Year, Amount]</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>             <span class="c1"># CMTE_ID</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>             <span class="c1"># Name</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">][:</span><span class="mi">5</span><span class="p">])</span>        <span class="c1"># Zip-code</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]))</span>  <span class="c1"># Year</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">14</span><span class="p">]))</span>       <span class="c1"># Amount</span>
    <span class="k">return</span> <span class="n">entry</span>


<span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Checks if entry has valid format</span>
<span class="sd">    </span>
<span class="sd">    It checks whether the entry is an individual contribution,</span>
<span class="sd">    whether the date format is valid, whether the zip code</span>
<span class="sd">    or the name is malformed and also check the CMTE_ID and</span>
<span class="sd">    the Transaction_AMT are not empty</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        entry (list): list containing the details of the donation from the original</span>
<span class="sd">            file</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        boolean: True if entry is valid, False otherwise</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check it has the right number of entries</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">21</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c1"># Check if Other_ID is empty</span>
    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c1"># Check if date is malformed</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="s1">&#39;%m</span><span class="si">%d</span><span class="s1">%Y&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c1"># Check if zip code is malformed</span>
    <span class="n">is_zip</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d{5}.*&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_zip</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c1"># check if name is malformed</span>
    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c1"># check if CMTE_ID, Transaction_AMT are non-empty</span>
    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">entry</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>


<span class="k">def</span> <span class="nf">add_donor</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; If this is the donors earliest donation, then it saves the year of this donation under the donor&#39;s key</span>

<span class="sd">    Checks if donor (identified by name + zip code) has an earlier donation.</span>
<span class="sd">    If that is the case, it checks whether the new donation record is</span>
<span class="sd">    from an earlier time (our input may not be chronological). In this</span>
<span class="sd">    case, it updates the value to the year of the current entry.</span>
<span class="sd">    If this is the first donation, then the year is stored</span>
<span class="sd">    under the donor&#39;s key.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        entry (list): list containing the details of the donation, it has</span>
<span class="sd">            the format_entry [recipient, donor name, zip, year, amount]</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        No return value</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">donor_key</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># name+zip</span>
    <span class="k">if</span> <span class="n">donor_key</span> <span class="ow">in</span> <span class="n">repeat_donors</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">repeat_donors</span><span class="p">[</span><span class="n">donor_key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">repeat_donors</span><span class="p">[</span><span class="n">donor_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">repeat_donors</span><span class="p">[</span><span class="n">donor_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">add_recipients</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Checks if donation is from repeated donor and adds it to recipient list.</span>

<span class="sd">    If the entry is from a repeated donor, then the donation will be added to</span>
<span class="sd">    list of donations to the recipient from the zip code. Hence, the tuple</span>
<span class="sd">    (recipient, zip, year) is used as the key in the dictionary recipients.</span>
<span class="sd">    The value associated is a sorted list of the $-amount of the donations.</span>
<span class="sd">    The sorted list is used adding to it has amortized constant time complexity</span>
<span class="sd">    and a sorted list allows for fast percentile computation.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        entry (list): list containing the details of the donation,</span>
<span class="sd">            it has the format_entry [recipient, donor name, zip, year, amount]</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        recip_key (tuple): None if donation was not from repeated donor.</span>
<span class="sd">            Otherwise the tuple (recipient, zip, year) which was</span>
<span class="sd">            used to save the amount</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">donor_key</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">recip_key</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1">#  check if donor has donated in a previous year</span>
    <span class="k">if</span> <span class="n">donor_key</span> <span class="ow">in</span> <span class="n">repeat_donors</span> <span class="ow">and</span> <span class="n">repeat_donors</span><span class="p">[</span><span class="n">donor_key</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
        <span class="c1"># store donation amount under (recipient, zip, year)</span>
        <span class="n">recip_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">recip_key</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
            <span class="n">recipients</span><span class="p">[</span><span class="n">recip_key</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recipients</span><span class="p">[</span><span class="n">recip_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">SortedList</span><span class="p">([</span><span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">recip_key</span>


<span class="c1"># Only run main if module is executed as main</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="repeated_donor_analysis.recipients" class="name">var <span class="ident">recipients</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="repeated_donor_analysis.repeat_donors" class="name">var <span class="ident">repeat_donors</span></p>
      
  
  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="repeated_donor_analysis.add_donor">
    <p>def <span class="ident">add_donor</span>(</p><p>entry)</p>
    </div>
    

    
  
    <div class="desc"><p>If this is the donors earliest donation, then it saves the year of this donation under the donor's key</p>
<p>Checks if donor (identified by name + zip code) has an earlier donation.
If that is the case, it checks whether the new donation record is
from an earlier time (our input may not be chronological). In this
case, it updates the value to the year of the current entry.
If this is the first donation, then the year is stored
under the donor's key.</p>
<p>Args:
    entry (list): list containing the details of the donation, it has
        the format_entry [recipient, donor name, zip, year, amount]</p>
<p>Return:
    No return value</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-repeated_donor_analysis.add_donor', this);">Show source &equiv;</a></p>
  <div id="source-repeated_donor_analysis.add_donor" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_donor</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; If this is the donors earliest donation, then it saves the year of this donation under the donor&#39;s key</span>

<span class="sd">    Checks if donor (identified by name + zip code) has an earlier donation.</span>
<span class="sd">    If that is the case, it checks whether the new donation record is</span>
<span class="sd">    from an earlier time (our input may not be chronological). In this</span>
<span class="sd">    case, it updates the value to the year of the current entry.</span>
<span class="sd">    If this is the first donation, then the year is stored</span>
<span class="sd">    under the donor&#39;s key.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        entry (list): list containing the details of the donation, it has</span>
<span class="sd">            the format_entry [recipient, donor name, zip, year, amount]</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        No return value</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">donor_key</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># name+zip</span>
    <span class="k">if</span> <span class="n">donor_key</span> <span class="ow">in</span> <span class="n">repeat_donors</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">repeat_donors</span><span class="p">[</span><span class="n">donor_key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">repeat_donors</span><span class="p">[</span><span class="n">donor_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">repeat_donors</span><span class="p">[</span><span class="n">donor_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="repeated_donor_analysis.add_recipients">
    <p>def <span class="ident">add_recipients</span>(</p><p>entry)</p>
    </div>
    

    
  
    <div class="desc"><p>Checks if donation is from repeated donor and adds it to recipient list.</p>
<p>If the entry is from a repeated donor, then the donation will be added to
list of donations to the recipient from the zip code. Hence, the tuple
(recipient, zip, year) is used as the key in the dictionary recipients.
The value associated is a sorted list of the $-amount of the donations.
The sorted list is used adding to it has amortized constant time complexity
and a sorted list allows for fast percentile computation.</p>
<p>Args:
    entry (list): list containing the details of the donation,
        it has the format_entry [recipient, donor name, zip, year, amount]</p>
<p>Return:
    recip_key (tuple): None if donation was not from repeated donor.
        Otherwise the tuple (recipient, zip, year) which was
        used to save the amount</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-repeated_donor_analysis.add_recipients', this);">Show source &equiv;</a></p>
  <div id="source-repeated_donor_analysis.add_recipients" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">add_recipients</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Checks if donation is from repeated donor and adds it to recipient list.</span>

<span class="sd">    If the entry is from a repeated donor, then the donation will be added to</span>
<span class="sd">    list of donations to the recipient from the zip code. Hence, the tuple</span>
<span class="sd">    (recipient, zip, year) is used as the key in the dictionary recipients.</span>
<span class="sd">    The value associated is a sorted list of the $-amount of the donations.</span>
<span class="sd">    The sorted list is used adding to it has amortized constant time complexity</span>
<span class="sd">    and a sorted list allows for fast percentile computation.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        entry (list): list containing the details of the donation,</span>
<span class="sd">            it has the format_entry [recipient, donor name, zip, year, amount]</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        recip_key (tuple): None if donation was not from repeated donor.</span>
<span class="sd">            Otherwise the tuple (recipient, zip, year) which was</span>
<span class="sd">            used to save the amount</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">donor_key</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">recip_key</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1">#  check if donor has donated in a previous year</span>
    <span class="k">if</span> <span class="n">donor_key</span> <span class="ow">in</span> <span class="n">repeat_donors</span> <span class="ow">and</span> <span class="n">repeat_donors</span><span class="p">[</span><span class="n">donor_key</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
        <span class="c1"># store donation amount under (recipient, zip, year)</span>
        <span class="n">recip_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">recip_key</span> <span class="ow">in</span> <span class="n">recipients</span><span class="p">:</span>
            <span class="n">recipients</span><span class="p">[</span><span class="n">recip_key</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recipients</span><span class="p">[</span><span class="n">recip_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">SortedList</span><span class="p">([</span><span class="n">entry</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">recip_key</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="repeated_donor_analysis.extract">
    <p>def <span class="ident">extract</span>(</p><p>line)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a line containing a valid donation, extracts the information we need.</p>
<p>It extracts CMTE_ID, Name of donor, Zip-code, Year,
and amount of donation in a list in this order. As we only apply this function after
checking entry for validity, no exceptions are handled.</p>
<p>Args:
    line (list): list containing the details of a valid donation
    from the original file</p>
<p>Return:
    entry (list): Returns a list with the relevant details of the donation,
        it has the formation [CMTE_ID, Name, Zip-code, Year, Amount]</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-repeated_donor_analysis.extract', this);">Show source &equiv;</a></p>
  <div id="source-repeated_donor_analysis.extract" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Given a line containing a valid donation, extracts the information we need.</span>

<span class="sd">    It extracts CMTE_ID, Name of donor, Zip-code, Year,</span>
<span class="sd">    and amount of donation in a list in this order. As we only apply this function after</span>
<span class="sd">    checking entry for validity, no exceptions are handled.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        line (list): list containing the details of a valid donation</span>
<span class="sd">        from the original file</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        entry (list): Returns a list with the relevant details of the donation,</span>
<span class="sd">            it has the formation [CMTE_ID, Name, Zip-code, Year, Amount]</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>             <span class="c1"># CMTE_ID</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>             <span class="c1"># Name</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">][:</span><span class="mi">5</span><span class="p">])</span>        <span class="c1"># Zip-code</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">13</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">:]))</span>  <span class="c1"># Year</span>
    <span class="n">entry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">14</span><span class="p">]))</span>       <span class="c1"># Amount</span>
    <span class="k">return</span> <span class="n">entry</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="repeated_donor_analysis.format_entry">
    <p>def <span class="ident">format_entry</span>(</p><p>percentile, recipient_key)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a percentile and (recipient,zip-code,year) key, returns the output string </p>
<p>The output string has the format:
'recipient|zip-code|year|percentile_value|total_amount|number of contributions'</p>
<p>Args:
    percentile (int): percentile value that is computed
    recipient_key (tuple): A tuple of the form (recipient, zip-code, year),
        this is the key to the record we want to compute the percentile of.</p>
<p>Return:
    line (string): a string summarizing the recipients donations
        from the zip code in the given year.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-repeated_donor_analysis.format_entry', this);">Show source &equiv;</a></p>
  <div id="source-repeated_donor_analysis.format_entry" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">format_entry</span><span class="p">(</span><span class="n">percentile</span><span class="p">,</span> <span class="n">recipient_key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Given a percentile and (recipient,zip-code,year) key, returns the output string </span>

<span class="sd">    The output string has the format:</span>
<span class="sd">    &#39;recipient|zip-code|year|percentile_value|total_amount|number of contributions&#39;</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        percentile (int): percentile value that is computed</span>
<span class="sd">        recipient_key (tuple): A tuple of the form (recipient, zip-code, year),</span>
<span class="sd">            this is the key to the record we want to compute the percentile of.</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        line (string): a string summarizing the recipients donations</span>
<span class="sd">            from the zip code in the given year.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">percentile_value</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">percentile_count</span><span class="p">(</span><span class="n">percentile</span><span class="p">,</span> <span class="n">recipient_key</span><span class="p">)</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">recipients</span><span class="p">[</span><span class="n">recipient_key</span><span class="p">]</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">recipient_key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span> <span class="o">+</span> <span class="n">recipient_key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span>
    <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">recipient_key</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span>
    <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">percentile_value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span>
    <span class="n">line</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="repeated_donor_analysis.is_valid">
    <p>def <span class="ident">is_valid</span>(</p><p>entry)</p>
    </div>
    

    
  
    <div class="desc"><p>Checks if entry has valid format</p>
<p>It checks whether the entry is an individual contribution,
whether the date format is valid, whether the zip code
or the name is malformed and also check the CMTE_ID and
the Transaction_AMT are not empty</p>
<p>Args:
    entry (list): list containing the details of the donation from the original
        file</p>
<p>Return:
    boolean: True if entry is valid, False otherwise</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-repeated_donor_analysis.is_valid', this);">Show source &equiv;</a></p>
  <div id="source-repeated_donor_analysis.is_valid" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Checks if entry has valid format</span>
<span class="sd">    </span>
<span class="sd">    It checks whether the entry is an individual contribution,</span>
<span class="sd">    whether the date format is valid, whether the zip code</span>
<span class="sd">    or the name is malformed and also check the CMTE_ID and</span>
<span class="sd">    the Transaction_AMT are not empty</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        entry (list): list containing the details of the donation from the original</span>
<span class="sd">            file</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        boolean: True if entry is valid, False otherwise</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check it has the right number of entries</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">21</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c1"># Check if Other_ID is empty</span>
    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c1"># Check if date is malformed</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="s1">&#39;%m</span><span class="si">%d</span><span class="s1">%Y&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c1"># Check if zip code is malformed</span>
    <span class="n">is_zip</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d{5}.*&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_zip</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c1"># check if name is malformed</span>
    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c1"># check if CMTE_ID, Transaction_AMT are non-empty</span>
    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">entry</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="repeated_donor_analysis.main">
    <p>def <span class="ident">main</span>(</p><p>)</p>
    </div>
    

    
  
    <div class="desc"><p>Extracts the system arguments and runs process_file</p>
<p>The function reads three inputs from the command line:
input file, output file and a file containing a single
integer, the percentile value. It checks that there are
enough arguments and passes them on to the reader.</p>
<p>Args:</p>
<p>Returns:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-repeated_donor_analysis.main', this);">Show source &equiv;</a></p>
  <div id="source-repeated_donor_analysis.main" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Extracts the system arguments and runs process_file</span>
<span class="sd">    </span>
<span class="sd">    The function reads three inputs from the command line:</span>
<span class="sd">    input file, output file and a file containing a single</span>
<span class="sd">    integer, the percentile value. It checks that there are</span>
<span class="sd">    enough arguments and passes them on to the reader.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">process_file</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="repeated_donor_analysis.percentile_count">
    <p>def <span class="ident">percentile_count</span>(</p><p>percentile, recipient_key)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a percentile and (recipient,zip-code,year) key, returns the percentile and the count of the contributions</p>
<p>It uses the recipient_key to access all donations to the recipient in the
given year and zip-code. These donations are in the form of a sorted list,
the percentile can be easily computed via the nearest rank method.
The number of contributions is also computed and returned. Returns
0, -1 if key is not valid and 0, -2 if percentile is not valid.</p>
<p>Args:
    percentile (int): percentile value that is computed
    recipient_key (tuple): A tuple of the form (recipient, zip-code, year), this is the key
        to the record we want to compute the percentile of.</p>
<p>Return:
    percentile value (int): Percentile value of contributions
    count (init): number of contributions</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-repeated_donor_analysis.percentile_count', this);">Show source &equiv;</a></p>
  <div id="source-repeated_donor_analysis.percentile_count" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">percentile_count</span><span class="p">(</span><span class="n">percentile</span><span class="p">,</span> <span class="n">recipient_key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Given a percentile and (recipient,zip-code,year) key, returns the percentile and the count of the contributions</span>

<span class="sd">    It uses the recipient_key to access all donations to the recipient in the</span>
<span class="sd">    given year and zip-code. These donations are in the form of a sorted list,</span>
<span class="sd">    the percentile can be easily computed via the nearest rank method.</span>
<span class="sd">    The number of contributions is also computed and returned. Returns</span>
<span class="sd">    0, -1 if key is not valid and 0, -2 if percentile is not valid.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        percentile (int): percentile value that is computed</span>
<span class="sd">        recipient_key (tuple): A tuple of the form (recipient, zip-code, year), this is the key</span>
<span class="sd">            to the record we want to compute the percentile of.</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">        percentile value (int): Percentile value of contributions</span>
<span class="sd">        count (init): number of contributions</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recipients</span><span class="p">[</span><span class="n">recipient_key</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">percentile</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">recipients</span><span class="p">[</span><span class="n">recipient_key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">count</span>
        <span class="k">if</span> <span class="n">percentile</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">or</span> <span class="n">percentile</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span>
        <span class="c1"># use nearest rank method to compute percentile</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">percentile</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">count</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">recipients</span><span class="p">[</span><span class="n">recipient_key</span><span class="p">][</span><span class="n">index</span><span class="p">]),</span> <span class="n">count</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="repeated_donor_analysis.process_file">
    <p>def <span class="ident">process_file</span>(</p><p>input_file_path, percentile_file_path, output_file_path)</p>
    </div>
    

    
  
    <div class="desc"><p>Given a percentile, an input and an output file, computes percentiles of donations</p>
<p>The function reads the input file sequentually and saves repeated donors.
If a line contains donation from a repeated donor, then for the recipients
donations from repeated donors from this zip code, the percentile value is
computed and the information is stored in the output_content strin.
After having processed the input file, output_content is written into the
output_file_path.</p>
<p>Args:
    input_file_path (string): A string with the path to the input file
    percentile_file_path (string): A string with the path to the
        file that contains the percentile value
    output_file_path (string): A string with the path to the output file</p>
<p>Return:</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-repeated_donor_analysis.process_file', this);">Show source &equiv;</a></p>
  <div id="source-repeated_donor_analysis.process_file" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">process_file</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">,</span> <span class="n">percentile_file_path</span><span class="p">,</span>  <span class="n">output_file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Given a percentile, an input and an output file, computes percentiles of donations</span>

<span class="sd">    The function reads the input file sequentually and saves repeated donors.</span>
<span class="sd">    If a line contains donation from a repeated donor, then for the recipients</span>
<span class="sd">    donations from repeated donors from this zip code, the percentile value is</span>
<span class="sd">    computed and the information is stored in the output_content strin.</span>
<span class="sd">    After having processed the input file, output_content is written into the</span>
<span class="sd">    output_file_path.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        input_file_path (string): A string with the path to the input file</span>
<span class="sd">        percentile_file_path (string): A string with the path to the</span>
<span class="sd">            file that contains the percentile value</span>
<span class="sd">        output_file_path (string): A string with the path to the output file</span>
<span class="sd">    </span>
<span class="sd">    Return:</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">percentile_file_path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Read percentile value and convert it to integer</span>
        <span class="n">percentile_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">percentile_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    
        <span class="k">try</span><span class="p">:</span>
            <span class="n">percentile</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">percentile_file</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Percentile was not an integer&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">percentile_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Store output in variable, slightly faster then dumping lines individually</span>
        <span class="n">output_content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># Process evert line of input file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_file</span><span class="p">:</span>
                <span class="n">entry</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_valid</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
                    <span class="c1"># extract relevant details of donation</span>
                    <span class="n">donation</span> <span class="o">=</span> <span class="n">extract</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                    <span class="c1"># update donors information in repeat_donor</span>
                    <span class="n">add_donor</span><span class="p">(</span><span class="n">donation</span><span class="p">)</span>
                    <span class="c1"># check if donation is from repeated donor, return recipient</span>
                    <span class="n">recipient_key</span> <span class="o">=</span> <span class="n">add_recipients</span><span class="p">(</span><span class="n">donation</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">recipient_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">output_content</span> <span class="o">+=</span> <span class="n">format_entry</span><span class="p">(</span><span class="n">percentile</span><span class="p">,</span> <span class="n">recipient_key</span><span class="p">)</span>
                        <span class="n">output_content</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1"># Save output to file</span>
            <span class="n">output_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">)</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_content</span><span class="p">)</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;There was an error reading/writing the files.&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  


  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
